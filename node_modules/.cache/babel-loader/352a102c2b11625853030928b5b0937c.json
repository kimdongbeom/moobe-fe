{"ast":null,"code":"import _slicedToArray from \"/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/src/components/desktop/map/DesktopKakaoMap.jsx\";\nimport React, { useEffect, useState } from 'react';\nimport MoobeKakaoMap from \"components/common/map/MoobeKakaoMap\";\nimport MarkerClusterer, { MarkerClustererCalculator, MarkerClustererStyles } from \"components/common/map/MarkerClusterer\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport MarkerImageSm from \"assets/images/marker_arrow_sm.svg\";\nimport MarkerImagePin from \"assets/images/marker_arrow_pin.svg\";\nimport MarkerImagePinFavorite from 'assets/images/marker_arrow_pin_favorite.png';\nimport CustomOverlay from \"components/common/map/CustomOverlay\";\nimport DetailContentOverlay from \"components/common/map/DetailContentOverlay\";\nimport { isEmpty as _isEmpty, isNil as _isNil } from 'lodash';\nimport { buildContentPath } from \"data/util\";\nimport { useHistory, useLocation, useParams } from \"react-router\";\nimport Marker from \"components/common/map/Marker\";\nimport { setShowOverlayContentDetail } from \"data/redux/action/contentDetail\";\nimport { setFocusedLocation } from \"data/redux/action/location\";\nimport MapLocationOverlay from \"components/common/map/MapLocationOverlay\";\nimport { forceCleanMarkerClusterer, setMapBounds, setSearchOnBoundChange } from \"data/redux/action/map\";\nimport MapLocation from \"data/redux/model/MapLocation\";\nimport ClusterMarker from \"components/common/map/ClusterMarker\";\nimport { mapBoundsMargin } from \"data/redux/reducers/mapReducer\";\n\nconst DesktopKakaoMap = () => {\n  const _useSelector = useSelector(state => state.mapClusterLocation),\n        mapClusterLocationList = _useSelector.mapClusterLocationList,\n        mapClusterLocationMarkerSize = _useSelector.mapClusterLocationMarkerSize,\n        mapClusterLocationMarkerList = _useSelector.mapClusterLocationMarkerList;\n\n  const _useSelector2 = useSelector(state => state.mapLocation),\n        mapLocationList = _useSelector2.mapLocationList,\n        mapLocationLoading = _useSelector2.mapLocationLoading,\n        focusedMapLocation = _useSelector2.focusedMapLocation;\n\n  const _useSelector3 = useSelector(state => state.map),\n        map = _useSelector3.map,\n        mapLevel = _useSelector3.mapLevel,\n        mapLoading = _useSelector3.mapLoading;\n\n  const _useSelector4 = useSelector(state => state.content),\n        contentLoading = _useSelector4.contentLoading;\n\n  const _useSelector5 = useSelector(state => state.contentDetail),\n        contentDetail = _useSelector5.contentDetail,\n        showOverlayContentDetail = _useSelector5.showOverlayContentDetail;\n\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const getLocationListWithoutDetailContent = () => {\n    if (!_isNil(contentDetail)) {\n      return mapLocationList.filter(location => location.id != contentDetail.id);\n    } else {\n      return mapLocationList;\n    }\n  };\n\n  const getClusterLocationListWithoutDetailContent = () => {\n    if (!_isNil(contentDetail)) {\n      return mapClusterLocationMarkerList.filter(location => location.id != contentDetail.id);\n    } else {\n      return mapClusterLocationMarkerList;\n    }\n  };\n\n  const getClusterLocationWithoutDetailContent = () => {\n    if (!_isNil(contentDetail)) {\n      return mapClusterLocationList.filter(clusterLocation => !clusterLocation.markerList.map(marker => marker.id == contentDetail.id).reduce((a, b) => a || b));\n    } else {\n      return mapClusterLocationMarkerList;\n    }\n  };\n\n  const onClusterClick = cluster => {\n    if (map) {\n      const latLngList = cluster.getMarkers().map(m => {\n        return {\n          lat: m.mapLocation.latitude,\n          lng: m.mapLocation.longitude\n        };\n      });\n      dispatch(forceCleanMarkerClusterer());\n      dispatch(setSearchOnBoundChange(true));\n      dispatch(setMapBounds(latLngList, mapBoundsMargin));\n    }\n  };\n\n  const renderSingleClusterMarker = mapClusterLocation => {\n    return contentDetail && contentDetail.id != mapClusterLocation.markerList[0].id ? React.createElement(MarkerWithFocusedOverlay, {\n      key: mapClusterLocation.markerList[0].id,\n      mapLocation: new MapLocation(mapClusterLocation.markerList[0]),\n      visible: false,\n      isFocusedMarker: focusedMapLocation && focusedMapLocation.id == mapClusterLocation.markerList[0].id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69\n      },\n      __self: this\n    }) : null;\n  };\n\n  const renderClusterFocusedMarker = mapLocation => {\n    return React.createElement(CustomOverlay, {\n      lat: mapLocation.latitude,\n      lng: mapLocation.longitude,\n      visible: true,\n      options: {\n        offsetY: 38,\n        zIndex: 3\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, React.createElement(MapLocationOverlay, {\n      mapLocation: mapLocation,\n      hasShadow: true,\n      hoverShadow: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    }));\n  };\n\n  const alwaysShowLocationOverlay = !mapLocationLoading && !_isEmpty(mapLocationList) && !mapLoading && (mapLocationList.length <= 6 || mapLevel < 5);\n  const alwaysShowClusterLocationOverlay = !mapLoading && (mapClusterLocationMarkerSize <= 6 || mapLevel < 5);\n  return React.createElement(React.Fragment, null, React.createElement(MoobeKakaoMap, {\n    className: \"column box is-paddingless kakao-map is-fullheight-with-navbar-fixed-height is-marginless\",\n    zoom: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }, React.createElement(MarkerClusterer, {\n    isMain: true,\n    options: {\n      averageCenter: true,\n      minLevel: 5,\n      disableClickZoom: true,\n      minClusterSize: 3,\n      calculator: MarkerClustererCalculator,\n      styles: MarkerClustererStyles\n    },\n    onClusterClick: onClusterClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, getLocationListWithoutDetailContent().map(mapLocation => React.createElement(MarkerWithFocusedOverlay, {\n    key: mapLocation.id,\n    mapLocation: mapLocation,\n    visible: alwaysShowLocationOverlay,\n    isFocusedMarker: focusedMapLocation && focusedMapLocation.id == mapLocation.id,\n    hasShadow: !alwaysShowLocationOverlay || focusedMapLocation && focusedMapLocation.id == mapLocation.id,\n    hoverShadow: alwaysShowLocationOverlay,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }))), !_isEmpty(contentDetail) ? React.createElement(MarkerWithCustomOverlay, {\n    content: contentDetail,\n    liked: contentDetail && contentDetail.liked ? true : false,\n    visible: showOverlayContentDetail,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }) : alwaysShowClusterLocationOverlay ? getClusterLocationListWithoutDetailContent().map(mapLocation => React.createElement(MarkerWithFocusedOverlay, {\n    key: mapLocation.id,\n    mapLocation: mapLocation,\n    visible: alwaysShowClusterLocationOverlay,\n    isFocusedMarker: focusedMapLocation && focusedMapLocation.id == mapLocation.id,\n    hasShadow: !alwaysShowClusterLocationOverlay || focusedMapLocation && focusedMapLocation.id == mapLocation.id,\n    hoverShadow: alwaysShowClusterLocationOverlay,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  })) : mapClusterLocationList.map(m => React.createElement(ClusterMarker, {\n    key: m.centerLatitude + \"\" + m.centerLongitude + \"\" + m.markerListSize,\n    mapClusterLocation: m,\n    renderFocusedMarker: renderClusterFocusedMarker,\n    renderSingleMarker: renderSingleClusterMarker,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }))));\n};\n\nconst MarkerWithCustomOverlay = ({\n  content,\n  liked,\n  visible\n}) => {\n  const dispatch = useDispatch();\n\n  const showOverlay = () => {\n    dispatch(setShowOverlayContentDetail(true));\n    dispatch(setFocusedLocation(null));\n  };\n\n  useEffect(() => {\n    dispatch(setFocusedLocation(null));\n  }, [content]);\n  return React.createElement(React.Fragment, null, React.createElement(Marker, {\n    options: {\n      lat: content.store.latitude,\n      lng: content.store.longitude,\n      content: content.store.name,\n      zIndex: 2,\n      imageUrl: liked ? MarkerImagePinFavorite : MarkerImagePin,\n      imageOption: {\n        url: liked ? MarkerImagePinFavorite : MarkerImagePin,\n        width: 46,\n        height: 61\n      }\n    },\n    onClick: marker => showOverlay(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }), React.createElement(CustomOverlay, {\n    lat: content.store.latitude,\n    lng: content.store.longitude,\n    visible: visible,\n    options: {\n      offsetY: 72,\n      zIndex: 2\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, React.createElement(DetailContentOverlay, {\n    content: content,\n    visible: visible,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  })));\n};\n\nconst MarkerWithFocusedOverlay = ({\n  mapLocation,\n  visible = false,\n  isFocusedMarker = false,\n  hasShadow = true,\n  hoverShadow = false\n}) => {\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        isFocused = _useState2[0],\n        setIsFocused = _useState2[1];\n\n  const _useState3 = useState(1),\n        _useState4 = _slicedToArray(_useState3, 2),\n        zIndex = _useState4[0],\n        setZIndex = _useState4[1];\n\n  const _useSelector6 = useSelector(state => state.channel),\n        activeChannel = _useSelector6.activeChannel;\n\n  const _useSelector7 = useSelector(state => state.mapLocation),\n        focusedMapLocation = _useSelector7.focusedMapLocation;\n\n  let focused = !_isNil(focusedMapLocation) && mapLocation.id === focusedMapLocation.id || isFocused || isFocusedMarker;\n  const history = useHistory();\n  const location = useLocation();\n\n  const _useParams = useParams(),\n        channelId = _useParams.channelId,\n        contentId = _useParams.contentId;\n\n  const updateActiveContent = content => {\n    console.log(\"click active channel \", activeChannel, channelId, contentId);\n    history.push({\n      pathname: buildContentPath(activeChannel ? activeChannel : channelId ? {\n        id: channelId\n      } : null, content),\n      search: window.location.search\n    });\n  }; //TODO seperate overlay div.\n\n\n  useEffect(() => {\n    if (isFocused || isFocusedMarker) {\n      setZIndex(3);\n    } else {\n      setZIndex(1);\n    }\n  }, [isFocused, isFocusedMarker]);\n  return React.createElement(React.Fragment, null, React.createElement(Marker, {\n    onMouseOver: e => setIsFocused(true),\n    onMouseOut: e => setIsFocused(false),\n    onClick: marker => updateActiveContent(mapLocation),\n    options: {\n      lat: mapLocation.latitude,\n      lng: mapLocation.longitude,\n      content: mapLocation.name,\n      imageUrl: MarkerImageSm,\n      imageOption: {\n        url: MarkerImageSm,\n        width: 30,\n        height: 32\n      },\n      zIndex: zIndex\n    },\n    attributes: {\n      mapLocation\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }), React.createElement(CustomOverlay, {\n    lat: mapLocation.latitude,\n    lng: mapLocation.longitude,\n    visible: visible || focused,\n    options: {\n      offsetY: 38,\n      zIndex: zIndex\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, React.createElement(MapLocationOverlay, {\n    mapLocation: mapLocation,\n    hasShadow: hasShadow,\n    hoverShadow: hoverShadow,\n    handleMouseEnter: e => setIsFocused(true),\n    handleMouseLeave: e => setIsFocused(false),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  })));\n};\n\nexport default DesktopKakaoMap;","map":{"version":3,"sources":["/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/src/components/desktop/map/DesktopKakaoMap.jsx"],"names":["React","useEffect","useState","MoobeKakaoMap","MarkerClusterer","MarkerClustererCalculator","MarkerClustererStyles","useDispatch","useSelector","MarkerImagePinFavorite","CustomOverlay","DetailContentOverlay","isEmpty","_isEmpty","isNil","_isNil","buildContentPath","useHistory","useLocation","useParams","Marker","setShowOverlayContentDetail","setFocusedLocation","MapLocationOverlay","forceCleanMarkerClusterer","setMapBounds","setSearchOnBoundChange","MapLocation","ClusterMarker","mapBoundsMargin","DesktopKakaoMap","state","mapClusterLocation","mapClusterLocationList","mapClusterLocationMarkerSize","mapClusterLocationMarkerList","mapLocation","mapLocationList","mapLocationLoading","focusedMapLocation","map","mapLevel","mapLoading","content","contentLoading","contentDetail","showOverlayContentDetail","dispatch","history","getLocationListWithoutDetailContent","filter","location","id","getClusterLocationListWithoutDetailContent","getClusterLocationWithoutDetailContent","clusterLocation","markerList","marker","reduce","a","b","onClusterClick","cluster","latLngList","getMarkers","m","lat","latitude","lng","longitude","renderSingleClusterMarker","renderClusterFocusedMarker","offsetY","zIndex","alwaysShowLocationOverlay","length","alwaysShowClusterLocationOverlay","averageCenter","minLevel","disableClickZoom","minClusterSize","calculator","styles","liked","centerLatitude","centerLongitude","markerListSize","MarkerWithCustomOverlay","visible","showOverlay","store","name","imageUrl","MarkerImagePin","imageOption","url","width","height","MarkerWithFocusedOverlay","isFocusedMarker","hasShadow","hoverShadow","isFocused","setIsFocused","setZIndex","channel","activeChannel","focused","channelId","contentId","updateActiveContent","console","log","push","pathname","search","window","e","MarkerImageSm"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport MoobeKakaoMap from \"components/common/map/MoobeKakaoMap\";\nimport MarkerClusterer, {MarkerClustererCalculator, MarkerClustererStyles} from \"components/common/map/MarkerClusterer\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport MarkerImageSm from 'assets/images/marker_arrow_sm.svg';\nimport MarkerImagePin from 'assets/images/marker_arrow_pin.svg';\nimport MarkerImagePinFavorite from 'assets/images/marker_arrow_pin_favorite.png';\nimport CustomOverlay from \"components/common/map/CustomOverlay\";\nimport DetailContentOverlay from \"components/common/map/DetailContentOverlay\";\nimport {isEmpty as _isEmpty, isNil as _isNil} from 'lodash';\nimport {buildContentPath} from \"data/util\";\nimport {useHistory, useLocation, useParams} from \"react-router\";\nimport Marker from \"components/common/map/Marker\";\nimport {setShowOverlayContentDetail} from \"data/redux/action/contentDetail\";\nimport {setFocusedLocation} from \"data/redux/action/location\";\nimport MapLocationOverlay from \"components/common/map/MapLocationOverlay\";\nimport {forceCleanMarkerClusterer, setMapBounds, setSearchOnBoundChange} from \"data/redux/action/map\";\nimport MapLocation from \"data/redux/model/MapLocation\";\nimport ClusterMarker from \"components/common/map/ClusterMarker\";\nimport {mapBoundsMargin} from \"data/redux/reducers/mapReducer\";\n\nconst DesktopKakaoMap = () => {\n    const {mapClusterLocationList, mapClusterLocationMarkerSize, mapClusterLocationMarkerList} = useSelector(state => state.mapClusterLocation);\n    const {mapLocationList, mapLocationLoading, focusedMapLocation} = useSelector(state => state.mapLocation);\n    const {map, mapLevel, mapLoading} = useSelector(state => state.map);\n    const {contentLoading} = useSelector(state => state.content);\n    const {contentDetail, showOverlayContentDetail} = useSelector(state => state.contentDetail);\n    const dispatch = useDispatch()\n    const history = useHistory();\n\n    const getLocationListWithoutDetailContent = () => {\n        if (!_isNil(contentDetail)) {\n            return mapLocationList.filter(location => location.id != contentDetail.id)\n        } else {\n            return mapLocationList;\n        }\n    }\n\n    const getClusterLocationListWithoutDetailContent = () => {\n        if (!_isNil(contentDetail)) {\n            return mapClusterLocationMarkerList.filter(location => location.id != contentDetail.id)\n        } else {\n            return mapClusterLocationMarkerList\n        }\n    }\n\n    const getClusterLocationWithoutDetailContent = () => {\n        if (!_isNil(contentDetail)) {\n            return mapClusterLocationList.filter(clusterLocation => !clusterLocation.markerList.map(marker => marker.id == contentDetail.id).reduce((a, b) => a || b))\n\n        } else {\n            return mapClusterLocationMarkerList\n        }\n    }\n\n    const onClusterClick = (cluster) => {\n        if(map) {\n            const latLngList = cluster.getMarkers().map(m => {\n                return {lat: m.mapLocation.latitude, lng: m.mapLocation.longitude}\n            })\n            dispatch(forceCleanMarkerClusterer());\n            dispatch(setSearchOnBoundChange(true))\n            dispatch(setMapBounds(latLngList, mapBoundsMargin))\n        }\n    }\n\n    const renderSingleClusterMarker = (mapClusterLocation) => {\n        return contentDetail && contentDetail.id != mapClusterLocation.markerList[0].id\n            ? <MarkerWithFocusedOverlay key={mapClusterLocation.markerList[0].id}\n                                        mapLocation={new MapLocation(mapClusterLocation.markerList[0])}\n                                        visible={false}\n                                        isFocusedMarker={focusedMapLocation && focusedMapLocation.id == mapClusterLocation.markerList[0].id}/>\n            : null\n    }\n\n    const renderClusterFocusedMarker = (mapLocation) => {\n        return (\n            <CustomOverlay lat={mapLocation.latitude} lng={mapLocation.longitude} visible={true} options={{offsetY: 38, zIndex: 3}}>\n                <MapLocationOverlay mapLocation={mapLocation}\n                                    hasShadow={true}\n                                    hoverShadow={true}/>\n            </CustomOverlay>\n        )\n    }\n\n    const alwaysShowLocationOverlay =  !mapLocationLoading && !_isEmpty(mapLocationList) && !mapLoading && (mapLocationList.length <= 6 || mapLevel < 5)\n    const alwaysShowClusterLocationOverlay = !mapLoading && (mapClusterLocationMarkerSize <= 6 || mapLevel < 5)\n\n    return (\n        <>\n            <MoobeKakaoMap className=\"column box is-paddingless kakao-map is-fullheight-with-navbar-fixed-height is-marginless\" zoom={true}>\n                {/*single marker*/}\n                <MarkerClusterer\n                    isMain={true}\n                    options={{\n                    averageCenter: true,\n                    minLevel: 5,\n                    disableClickZoom: true,\n                    minClusterSize: 3,\n                    calculator: MarkerClustererCalculator,\n                    styles: MarkerClustererStyles\n                }} onClusterClick={onClusterClick}>\n                    {getLocationListWithoutDetailContent().map(mapLocation =>\n                        <MarkerWithFocusedOverlay key={mapLocation.id}\n                                                  mapLocation={mapLocation}\n                                                  visible={alwaysShowLocationOverlay}\n                                                  isFocusedMarker={focusedMapLocation && focusedMapLocation.id == mapLocation.id}\n                                                  hasShadow={!alwaysShowLocationOverlay || (focusedMapLocation && focusedMapLocation.id == mapLocation.id)}\n                                                  hoverShadow={alwaysShowLocationOverlay}\n                        />)}\n                </MarkerClusterer>\n\n                {/*detail marker*/}\n                {!_isEmpty(contentDetail)\n                    ? <MarkerWithCustomOverlay content={contentDetail} liked={contentDetail && contentDetail.liked ? true : false} visible={showOverlayContentDetail}/>\n                    : alwaysShowClusterLocationOverlay\n                        ? getClusterLocationListWithoutDetailContent().map(mapLocation =>\n                            <MarkerWithFocusedOverlay key={mapLocation.id}\n                                                      mapLocation={mapLocation}\n                                                      visible={alwaysShowClusterLocationOverlay}\n                                                      isFocusedMarker={focusedMapLocation && focusedMapLocation.id == mapLocation.id}\n                                                      hasShadow={!alwaysShowClusterLocationOverlay || (focusedMapLocation && focusedMapLocation.id == mapLocation.id)}\n                                                      hoverShadow={alwaysShowClusterLocationOverlay}/>)\n                        : mapClusterLocationList.map(m => <ClusterMarker key={m.centerLatitude + \"\" + m.centerLongitude + \"\" + m.markerListSize}\n                                                                         mapClusterLocation={m}\n                                                                         renderFocusedMarker={renderClusterFocusedMarker}\n                                                                         renderSingleMarker={renderSingleClusterMarker} />)}\n            </MoobeKakaoMap>\n        </>\n    )\n};\n\nconst MarkerWithCustomOverlay = ({content, liked, visible}) => {\n    const dispatch = useDispatch();\n    const showOverlay = () => {\n        dispatch(setShowOverlayContentDetail(true))\n        dispatch(setFocusedLocation(null))\n    }\n\n    useEffect(() => {\n        dispatch(setFocusedLocation(null))\n    }, [content])\n\n    return (\n        <>\n            <Marker options={{lat: content.store.latitude, lng: content.store.longitude, content: content.store.name, zIndex: 2,\n                            imageUrl: liked ? MarkerImagePinFavorite : MarkerImagePin,\n                            imageOption: {url: liked ? MarkerImagePinFavorite : MarkerImagePin, width: 46, height: 61}}}\n                onClick={(marker) => showOverlay()}\n            />\n            <CustomOverlay lat={content.store.latitude} lng={content.store.longitude} visible={visible} options={{offsetY: 72, zIndex: 2}}>\n                <DetailContentOverlay content={content} visible={visible}/>\n            </CustomOverlay>\n        </>\n    )\n}\n\nconst MarkerWithFocusedOverlay = ({mapLocation, visible=false, isFocusedMarker = false, hasShadow=true, hoverShadow=false}) => {\n    const [isFocused, setIsFocused] = useState(false);\n    const [zIndex, setZIndex] = useState(1);\n    const {activeChannel} = useSelector(state => state.channel);\n    const {focusedMapLocation} = useSelector(state => state.mapLocation);\n    let focused = (!_isNil(focusedMapLocation) && mapLocation.id === focusedMapLocation.id) || isFocused || isFocusedMarker;\n    const history = useHistory();\n    const location = useLocation();\n    const {channelId, contentId} = useParams();\n    const updateActiveContent = (content) => {\n        console.log(\"click active channel \", activeChannel, channelId, contentId)\n        history.push({\n            pathname: buildContentPath(activeChannel ? activeChannel : channelId ? {id: channelId} : null, content),\n            search: window.location.search\n        });\n    };\n    //TODO seperate overlay div.\n    useEffect(() => {\n        if (isFocused || isFocusedMarker) {\n            setZIndex(3)\n        } else {\n            setZIndex(1)\n        }\n    }, [isFocused, isFocusedMarker])\n\n    return (\n        <>\n            <Marker onMouseOver={(e) => setIsFocused(true)}\n                onMouseOut={(e) => setIsFocused(false)}\n                onClick={(marker) => updateActiveContent(mapLocation)}\n                options={{lat: mapLocation.latitude, lng: mapLocation.longitude, content: mapLocation.name,\n                    imageUrl: MarkerImageSm,\n                    imageOption: {url: MarkerImageSm, width: 30, height: 32},\n                    zIndex: zIndex}}\n                attributes={{mapLocation}}\n            />\n            <CustomOverlay lat={mapLocation.latitude} lng={mapLocation.longitude} visible={visible || focused} options={{offsetY: 38, zIndex: zIndex}}>\n                <MapLocationOverlay mapLocation={mapLocation}\n                                    hasShadow={hasShadow}\n                                    hoverShadow={hoverShadow}\n                                    handleMouseEnter={(e) => setIsFocused(true)}\n                                    handleMouseLeave={(e) => setIsFocused(false)} />\n            </CustomOverlay>\n        </>\n    )\n};\n\n\nexport default DesktopKakaoMap;"]},"metadata":{},"sourceType":"module"}