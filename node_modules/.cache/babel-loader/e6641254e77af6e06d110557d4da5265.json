{"ast":null,"code":"import _slicedToArray from \"/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/src/components/mobile/map/MobileKakaoMap.jsx\";\nimport React, { useEffect, useState } from 'react';\nimport MoobeKakaoMap from \"components/common/map/MoobeKakaoMap\";\nimport MarkerClusterer, { MarkerClustererCalculator, MarkerClustererStyles } from \"components/common/map/MarkerClusterer\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport MarkerImageSm from \"assets/images/marker_arrow_sm.svg\";\nimport MarkerImagePin from \"assets/images/marker_arrow_pin.svg\";\nimport MarkerImagePinFavorite from 'assets/images/marker_arrow_pin_favorite.png';\nimport CustomOverlay from \"components/common/map/CustomOverlay\";\nimport MapLocationOverlay from \"components/common/map/MapLocationOverlay\";\nimport { isEmpty as _isEmpty, isNil as _isNil } from 'lodash';\nimport Marker from \"components/common/map/Marker\";\nimport { useHistory, useLocation } from \"react-router\";\nimport { buildContentPath } from \"data/util\";\nimport { setFocusedLocation } from \"data/redux/action/location\";\nimport { forceCleanMarkerClusterer, setMapBounds, setSearchOnBoundChange } from \"data/redux/action/map\";\nimport { getContent } from \"data/api\";\nimport ClusterMarker from \"components/common/map/ClusterMarker\";\nimport MapLocation from \"data/redux/model/MapLocation\";\nimport { mapBoundsMargin } from \"data/redux/reducers/mapReducer\";\n\nconst MobileKakaoMap = () => {\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        focusedLocationLiked = _useState2[0],\n        setFocusedLocationLiked = _useState2[1];\n\n  const _useSelector = useSelector(state => state.mapClusterLocation),\n        mapClusterLocationList = _useSelector.mapClusterLocationList,\n        mapClusterLocationMarkerSize = _useSelector.mapClusterLocationMarkerSize,\n        mapClusterLocationMarkerList = _useSelector.mapClusterLocationMarkerList;\n\n  const _useSelector2 = useSelector(state => state.map),\n        map = _useSelector2.map,\n        mapLevel = _useSelector2.mapLevel,\n        mapLoading = _useSelector2.mapLoading;\n\n  const _useSelector3 = useSelector(state => state.mapLocation),\n        mapLocationList = _useSelector3.mapLocationList,\n        mapLocationLoading = _useSelector3.mapLocationLoading,\n        focusedMapLocation = _useSelector3.focusedMapLocation;\n\n  const dispatch = useDispatch();\n\n  const getLocationListWithoutFocusedContent = () => {\n    if (!_isNil(focusedMapLocation)) {\n      return mapLocationList.filter(mapLocation => mapLocation.id != focusedMapLocation.id);\n    } else {\n      return mapLocationList;\n    }\n  };\n\n  const getClusterLocationListWithoutFocusedContent = () => {\n    if (!_isNil(focusedMapLocation)) {\n      return mapClusterLocationMarkerList.filter(location => location.id != focusedMapLocation.id);\n    } else {\n      return mapClusterLocationMarkerList;\n    }\n  };\n\n  useEffect(() => {\n    if (focusedMapLocation) {\n      getContent(focusedMapLocation.id).then(response => {\n        if (response && response.data) {\n          setFocusedLocationLiked(response.data.liked);\n        }\n      });\n    }\n\n    return () => setFocusedLocationLiked(false);\n  }, [focusedMapLocation]);\n\n  const onClickMarker = mapLocation => {\n    dispatch(setFocusedLocation(mapLocation));\n  };\n\n  const onClusterClick = cluster => {\n    if (map) {\n      const latLngList = cluster.getMarkers().map(m => {\n        return {\n          lat: m.mapLocation.latitude,\n          lng: m.mapLocation.longitude\n        };\n      });\n      dispatch(forceCleanMarkerClusterer());\n      dispatch(setFocusedLocation(null));\n      dispatch(setSearchOnBoundChange(true));\n      dispatch(setMapBounds(latLngList, mapBoundsMargin));\n    }\n  };\n\n  const renderSingleClusterMarker = mapClusterLocation => {\n    let mapLocation = new MapLocation(mapClusterLocation.markerList[0]);\n    return alwaysShowLocationOverlay ? React.createElement(MarkerWithCustomOverlay, {\n      key: mapLocation.id,\n      mapLocation: mapLocation,\n      hasShadow: false,\n      markerOptions: {\n        imageUrl: MarkerImageSm,\n        imageOption: {\n          width: 30,\n          height: 32\n        }\n      },\n      onClick: e => onClickMarker(mapLocation),\n      overlayOffsetY: 38,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    }) : React.createElement(Marker, {\n      key: mapLocation.id,\n      onClick: marker => onClickMarker(mapLocation),\n      options: {\n        lat: mapLocation.latitude,\n        lng: mapLocation.longitude,\n        content: mapLocation.name,\n        imageUrl: MarkerImageSm,\n        imageOption: {\n          width: 30,\n          height: 32\n        }\n      },\n      attributes: {\n        mapLocation\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    });\n  };\n\n  const renderClusterFocusedMarker = mapLocation => {\n    return React.createElement(MarkerWithCustomOverlay, {\n      key: focusedMapLocation.id,\n      mapLocation: focusedMapLocation,\n      markerOptions: {\n        imageUrl: focusedLocationLiked ? MarkerImagePinFavorite : MarkerImagePin,\n        imageOption: {\n          width: 46,\n          height: 61\n        }\n      },\n      zIndex: 3,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    });\n  };\n\n  const alwaysShowLocationOverlay = !mapLocationLoading && !_isEmpty(mapLocationList) && !mapLoading && (mapLevel < 5 || mapLocationList.length <= 6);\n  const alwaysShowClusterLocationOverlay = !mapLoading && (mapClusterLocationMarkerSize <= 6 || mapLevel < 5);\n  return React.createElement(React.Fragment, null, React.createElement(MoobeKakaoMap, {\n    className: \"column is-paddingless kakao-map is-fullheight-with-navbar-mobile is-marginless\",\n    zoom: false,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(MarkerClusterer, {\n    options: {\n      averageCenter: false,\n      minLevel: 5,\n      disableClickZoom: true,\n      minClusterSize: 3,\n      calculator: MarkerClustererCalculator,\n      styles: MarkerClustererStyles\n    },\n    onClusterClick: onClusterClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, getLocationListWithoutFocusedContent().map(mapLocation => alwaysShowLocationOverlay ? React.createElement(MarkerWithCustomOverlay, {\n    key: mapLocation.id,\n    mapLocation: mapLocation,\n    hasShadow: false,\n    markerOptions: {\n      imageUrl: MarkerImageSm,\n      imageOption: {\n        width: 30,\n        height: 32\n      }\n    },\n    onClick: e => onClickMarker(mapLocation),\n    overlayOffsetY: 38,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }) : React.createElement(Marker, {\n    key: mapLocation.id,\n    onClick: marker => onClickMarker(mapLocation),\n    options: {\n      lat: mapLocation.latitude,\n      lng: mapLocation.longitude,\n      content: mapLocation.name,\n      imageUrl: MarkerImageSm,\n      imageOption: {\n        width: 30,\n        height: 32\n      }\n    },\n    attributes: {\n      mapLocation\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }))), !_isNil(focusedMapLocation) ? React.createElement(MarkerWithCustomOverlay, {\n    key: focusedMapLocation.id,\n    mapLocation: focusedMapLocation,\n    markerOptions: {\n      imageUrl: focusedLocationLiked ? MarkerImagePinFavorite : MarkerImagePin,\n      imageOption: {\n        width: 46,\n        height: 61\n      }\n    },\n    zIndex: 3,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }) : alwaysShowClusterLocationOverlay ? getClusterLocationListWithoutFocusedContent().map(mapLocation => React.createElement(MarkerWithCustomOverlay, {\n    key: mapLocation.id,\n    mapLocation: mapLocation,\n    hasShadow: false,\n    markerOptions: {\n      imageUrl: MarkerImageSm,\n      imageOption: {\n        width: 30,\n        height: 32\n      }\n    },\n    onClick: e => onClickMarker(mapLocation),\n    overlayOffsetY: 38,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  })) : mapClusterLocationList.map(m => React.createElement(ClusterMarker, {\n    key: m.centerLatitude + \"\" + m.centerLongitude + \"\" + m.markerListSize,\n    mapClusterLocation: m,\n    renderFocusedMarker: renderClusterFocusedMarker,\n    renderSingleMarker: renderSingleClusterMarker,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }))));\n};\n\nconst MarkerWithCustomOverlay = ({\n  mapLocation,\n  hasShadow = true,\n  showTag = true,\n  showArrow = true,\n  onClick = null,\n  markerOptions = {},\n  overlayOffsetY = 72,\n  zIndex = 1\n}) => {\n  const _useSelector4 = useSelector(state => state.channel),\n        activeChannel = _useSelector4.activeChannel;\n\n  const history = useHistory();\n  const location = useLocation();\n\n  const updateOverlayContent = mapLocation => {\n    if (onClick) {\n      onClick();\n    } else {\n      history.push({\n        pathname: buildContentPath(activeChannel, mapLocation),\n        search: location.search\n      });\n    }\n  };\n\n  return React.createElement(React.Fragment, null, React.createElement(Marker, {\n    onClick: marker => updateOverlayContent(mapLocation),\n    options: Object.assign({\n      lat: mapLocation.latitude,\n      lng: mapLocation.longitude,\n      content: mapLocation.name,\n      imageUrl: MarkerImagePin,\n      imageOption: {\n        width: 46,\n        height: 61\n      },\n      zIndex: zIndex\n    }, markerOptions),\n    attributes: {\n      mapLocation\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }), React.createElement(CustomOverlay, {\n    lat: mapLocation.latitude,\n    lng: mapLocation.longitude,\n    visible: true,\n    options: {\n      offsetY: overlayOffsetY,\n      zIndex: zIndex\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(MapLocationOverlay, {\n    mapLocation: mapLocation,\n    hasShadow: hasShadow,\n    handleClick: onClick,\n    showTag: showTag,\n    showArrow: showArrow,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  })));\n};\n\nexport default MobileKakaoMap;","map":{"version":3,"sources":["/Users/nhnent/IdeaProjects/moobe/src/main/webapps/moobe-fe/src/components/mobile/map/MobileKakaoMap.jsx"],"names":["React","useEffect","useState","MoobeKakaoMap","MarkerClusterer","MarkerClustererCalculator","MarkerClustererStyles","useDispatch","useSelector","MarkerImagePinFavorite","CustomOverlay","MapLocationOverlay","isEmpty","_isEmpty","isNil","_isNil","Marker","useHistory","useLocation","buildContentPath","setFocusedLocation","forceCleanMarkerClusterer","setMapBounds","setSearchOnBoundChange","getContent","ClusterMarker","MapLocation","mapBoundsMargin","MobileKakaoMap","focusedLocationLiked","setFocusedLocationLiked","state","mapClusterLocation","mapClusterLocationList","mapClusterLocationMarkerSize","mapClusterLocationMarkerList","map","mapLevel","mapLoading","mapLocation","mapLocationList","mapLocationLoading","focusedMapLocation","dispatch","getLocationListWithoutFocusedContent","filter","id","getClusterLocationListWithoutFocusedContent","location","then","response","data","liked","onClickMarker","onClusterClick","cluster","latLngList","getMarkers","m","lat","latitude","lng","longitude","renderSingleClusterMarker","markerList","alwaysShowLocationOverlay","imageUrl","MarkerImageSm","imageOption","width","height","e","marker","content","name","renderClusterFocusedMarker","MarkerImagePin","length","alwaysShowClusterLocationOverlay","averageCenter","minLevel","disableClickZoom","minClusterSize","calculator","styles","centerLatitude","centerLongitude","markerListSize","MarkerWithCustomOverlay","hasShadow","showTag","showArrow","onClick","markerOptions","overlayOffsetY","zIndex","channel","activeChannel","history","updateOverlayContent","push","pathname","search","Object","assign","offsetY"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport MoobeKakaoMap from \"components/common/map/MoobeKakaoMap\";\nimport MarkerClusterer, {MarkerClustererCalculator, MarkerClustererStyles} from \"components/common/map/MarkerClusterer\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport MarkerImageSm from 'assets/images/marker_arrow_sm.svg';\nimport MarkerImagePin from 'assets/images/marker_arrow_pin.svg';\nimport MarkerImagePinFavorite from 'assets/images/marker_arrow_pin_favorite.png';\nimport CustomOverlay from \"components/common/map/CustomOverlay\";\nimport MapLocationOverlay from \"components/common/map/MapLocationOverlay\";\nimport {isEmpty as _isEmpty, isNil as _isNil} from 'lodash'\nimport Marker from \"components/common/map/Marker\";\nimport {useHistory, useLocation} from \"react-router\";\nimport {buildContentPath} from \"data/util\";\nimport {setFocusedLocation} from \"data/redux/action/location\";\nimport {forceCleanMarkerClusterer, setMapBounds, setSearchOnBoundChange} from \"data/redux/action/map\";\nimport {getContent} from \"data/api\";\nimport ClusterMarker from \"components/common/map/ClusterMarker\";\nimport MapLocation from \"data/redux/model/MapLocation\";\nimport {mapBoundsMargin} from \"data/redux/reducers/mapReducer\";\n\nconst MobileKakaoMap = () => {\n    const [focusedLocationLiked, setFocusedLocationLiked] = useState(false);\n    const {mapClusterLocationList, mapClusterLocationMarkerSize, mapClusterLocationMarkerList} = useSelector(state => state.mapClusterLocation);\n    const {map, mapLevel, mapLoading} = useSelector(state => state.map);\n    const {mapLocationList, mapLocationLoading, focusedMapLocation} = useSelector(state => state.mapLocation);\n    const dispatch = useDispatch();\n\n    const getLocationListWithoutFocusedContent = () => {\n        if (!_isNil(focusedMapLocation)) {\n            return mapLocationList.filter(mapLocation => mapLocation.id != focusedMapLocation.id)\n        } else {\n            return mapLocationList;\n        }\n    }\n\n    const getClusterLocationListWithoutFocusedContent = () => {\n        if (!_isNil(focusedMapLocation)) {\n            return mapClusterLocationMarkerList.filter(location => location.id != focusedMapLocation.id)\n        } else {\n            return mapClusterLocationMarkerList\n        }\n    }\n\n    useEffect(() => {\n        if (focusedMapLocation) {\n            getContent(focusedMapLocation.id).then(response => {\n                if (response && response.data) {\n                    setFocusedLocationLiked(response.data.liked)\n                }\n            })\n        }\n        return () => setFocusedLocationLiked(false)\n    }, [focusedMapLocation])\n\n    const onClickMarker = (mapLocation) => {\n        dispatch(setFocusedLocation(mapLocation))\n    }\n\n    const onClusterClick = (cluster) => {\n        if(map) {\n            const latLngList = cluster.getMarkers().map(m => {\n                return {lat: m.mapLocation.latitude, lng: m.mapLocation.longitude}\n            })\n            dispatch(forceCleanMarkerClusterer());\n            dispatch(setFocusedLocation(null));\n            dispatch(setSearchOnBoundChange(true))\n            dispatch(setMapBounds(latLngList, mapBoundsMargin));\n        }\n    }\n\n    const renderSingleClusterMarker = (mapClusterLocation) => {\n        let mapLocation = new MapLocation(mapClusterLocation.markerList[0])\n        return alwaysShowLocationOverlay\n            ? <MarkerWithCustomOverlay key={mapLocation.id} mapLocation={mapLocation} hasShadow={false}\n                                       markerOptions={{imageUrl: MarkerImageSm, imageOption: {width: 30, height: 32}}} onClick={(e) => onClickMarker(mapLocation)}\n                                       overlayOffsetY={38}/>\n            : <Marker key={mapLocation.id} onClick={(marker) => onClickMarker(mapLocation)}\n                      options={{lat: mapLocation.latitude, lng: mapLocation.longitude, content: mapLocation.name, imageUrl: MarkerImageSm, imageOption: {width: 30, height: 32}}}\n                      attributes={{mapLocation}}/>\n    }\n\n    const renderClusterFocusedMarker = (mapLocation) => {\n        return (\n            <MarkerWithCustomOverlay key={focusedMapLocation.id}\n                                     mapLocation={focusedMapLocation}\n                                     markerOptions={{imageUrl: focusedLocationLiked ? MarkerImagePinFavorite : MarkerImagePin, imageOption: {width: 46, height: 61}}}\n                                     zIndex={3} />\n        )\n    }\n\n    const alwaysShowLocationOverlay =  !mapLocationLoading && !_isEmpty(mapLocationList) && !mapLoading && (mapLevel < 5 || mapLocationList.length <= 6)\n    const alwaysShowClusterLocationOverlay = !mapLoading && (mapClusterLocationMarkerSize <= 6 || mapLevel < 5)\n\n    return (\n        <>\n            <MoobeKakaoMap className=\"column is-paddingless kakao-map is-fullheight-with-navbar-mobile is-marginless\" zoom={false}>\n                {/*single marker*/}\n                <MarkerClusterer options={{\n                    averageCenter: false,\n                    minLevel: 5,\n                    disableClickZoom: true,\n                    minClusterSize: 3,\n                    calculator: MarkerClustererCalculator,\n                    styles: MarkerClustererStyles\n                }} onClusterClick={onClusterClick}>\n                    {getLocationListWithoutFocusedContent().map(mapLocation =>\n                        alwaysShowLocationOverlay\n                        ? <MarkerWithCustomOverlay key={mapLocation.id} mapLocation={mapLocation} hasShadow={false}\n                                                   markerOptions={{imageUrl: MarkerImageSm, imageOption: {width: 30, height: 32}}} onClick={(e) => onClickMarker(mapLocation)}\n                                                   overlayOffsetY={38}/>\n                        : <Marker key={mapLocation.id} onClick={(marker) => onClickMarker(mapLocation)}\n                                options={{lat: mapLocation.latitude, lng: mapLocation.longitude, content: mapLocation.name, imageUrl: MarkerImageSm, imageOption: {width: 30, height: 32}}}\n                                attributes={{mapLocation}}/>\n                    )}\n                </MarkerClusterer>\n                {/*focused marker overlay (after click marker)*/}\n                {!_isNil(focusedMapLocation)\n                    ? <MarkerWithCustomOverlay key={focusedMapLocation.id}\n                                                                        mapLocation={focusedMapLocation}\n                                                                        markerOptions={{imageUrl: focusedLocationLiked ? MarkerImagePinFavorite : MarkerImagePin, imageOption: {width: 46, height: 61}}}\n                                                                        zIndex={3} />\n                    : alwaysShowClusterLocationOverlay\n                        ? getClusterLocationListWithoutFocusedContent().map(mapLocation =>\n                            <MarkerWithCustomOverlay key={mapLocation.id} mapLocation={mapLocation} hasShadow={false}\n                                                     markerOptions={{imageUrl: MarkerImageSm, imageOption: {width: 30, height: 32}}} onClick={(e) => onClickMarker(mapLocation)}\n                                                     overlayOffsetY={38}/>)\n                        : mapClusterLocationList.map(m => <ClusterMarker key={m.centerLatitude + \"\" + m.centerLongitude + \"\" + m.markerListSize}\n                                                                    mapClusterLocation={m}\n                                                                    renderFocusedMarker={renderClusterFocusedMarker}\n                                                                    renderSingleMarker={renderSingleClusterMarker} />)}\n            </MoobeKakaoMap>\n        </>\n    )\n};\n\nconst MarkerWithCustomOverlay = ({mapLocation, hasShadow=true, showTag=true, showArrow=true, onClick=null, markerOptions={}, overlayOffsetY=72, zIndex=1}) => {\n    const {activeChannel} = useSelector(state => state.channel);\n    const history = useHistory();\n    const location = useLocation();\n    const updateOverlayContent = (mapLocation) => {\n        if (onClick) {\n            onClick()\n        } else {\n            history.push({\n                pathname: buildContentPath(activeChannel, mapLocation),\n                search: location.search\n            });\n        }\n\n    };\n\n    return (\n        <>\n            <Marker onClick={(marker) => updateOverlayContent(mapLocation)}\n                options={Object.assign({lat: mapLocation.latitude, lng: mapLocation.longitude, content: mapLocation.name, imageUrl: MarkerImagePin, imageOption: {width: 46, height: 61}, zIndex: zIndex}, markerOptions)}\n                attributes={{mapLocation}}/>\n            <CustomOverlay lat={mapLocation.latitude} lng={mapLocation.longitude} visible={true} options={{offsetY: overlayOffsetY, zIndex: zIndex}}>\n                <MapLocationOverlay mapLocation={mapLocation} hasShadow={hasShadow} handleClick={onClick} showTag={showTag} showArrow={showArrow} />\n            </CustomOverlay>\n        </>\n    )\n};\n\n\nexport default MobileKakaoMap;"]},"metadata":{},"sourceType":"module"}